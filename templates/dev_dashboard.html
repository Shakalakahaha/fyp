<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Dashboard - Churn Buster</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dev_dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Churn Buster</h2>
                <p>Developer Portal</p>
            </div>

            <nav class="sidebar-nav">
                <ul>
                    <li class="active">
                        <a href="#" id="nav-dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="nav-retrain">
                            <i class="fas fa-sync-alt"></i>
                            <span>Retrain Model</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="nav-manage">
                            <i class="fas fa-cogs"></i>
                            <span>Manage Models</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="nav-predict">
                            <i class="fas fa-chart-line"></i>
                            <span>Predict Churn</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="nav-history">
                            <i class="fas fa-history"></i>
                            <span>Prediction History</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="nav-faq">
                            <i class="fas fa-question-circle"></i>
                            <span>FAQ</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <a href="/logout" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
                <p class="company-info">Company ID: {{ session.user.company_id }}</p>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="content-header">
                <div class="header-left">
                    <button id="sidebar-toggle" class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Developer Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <span>{{ session.user.email }}</span>
                        <i class="fas fa-user-circle"></i>
                    </div>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div class="content-container" id="dashboard-content">
                <!-- Quick Actions -->
                <section class="card quick-actions">
                    <div class="card-header">
                        <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
                    </div>
                    <div class="card-body">
                        <div class="action-grid">
                            <div class="action-card">
                                <div class="action-icon">
                                    <i class="fas fa-sync-alt"></i>
                                </div>
                                <h3>Retrain Model</h3>
                                <p>Upload new dataset to retrain and improve model performance</p>
                                <button id="retrainBtn" class="action-button primary" data-section="retrain">
                                    <i class="fas fa-play"></i> Start Retraining
                                </button>
                            </div>
                            <div class="action-card">
                                <div class="action-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <h3>Make Prediction</h3>
                                <p>Upload customer data to predict churn probability</p>
                                <button id="predictBtn" class="action-button primary" data-section="predict">
                                    <i class="fas fa-play"></i> Start Prediction
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Available Models -->
                <section class="card available-models">
                    <div class="card-header">
                        <h2><i class="fas fa-cubes"></i> Available Models</h2>
                    </div>
                    <div class="card-body">
                        <div class="models-table-container">
                            <table class="models-table">
                                <thead>
                                    <tr>
                                        <th>Model Name</th>
                                        <th>Type</th>
                                        <th>Version</th>
                                        <th>Accuracy</th>
                                        <th>Precision</th>
                                        <th>Recall</th>
                                        <th>F1 Score</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="modelsTableBody">
                                    <!-- Model data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Other content sections will be hidden initially -->

            <div class="content-container hidden" id="manage-content">
                <section class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-cogs"></i> Manage Models</h2>
                    </div>
                    <div class="card-body">
                        <div class="models-management-container">
                            <div class="models-filter">
                                <div class="search-box">
                                    <input type="text" id="model-search" placeholder="Search models...">
                                    <i class="fas fa-search"></i>
                                </div>
                                <div class="filter-options">
                                    <select id="model-type-filter">
                                        <option value="all">All Model Types</option>
                                        <option value="1">Gradient Boosting</option>
                                        <option value="2">Random Forest</option>
                                        <option value="3">Decision Tree</option>
                                        <option value="4">Logistic Regression</option>
                                    </select>
                                </div>
                            </div>

                            <div class="models-table-wrapper">
                                <table class="models-table" id="manage-models-table">
                                    <thead>
                                        <tr>
                                            <th>Model Name</th>
                                            <th>Type</th>
                                            <th>Version</th>
                                            <th>Accuracy</th>
                                            <th>Created Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="models-table-body">
                                        <!-- Models will be loaded here dynamically -->
                                        <tr class="loading-row">
                                            <td colspan="6" class="text-center">
                                                <i class="fas fa-spinner fa-spin"></i> Loading models...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="models-pagination">
                                <button id="prev-page" class="pagination-btn" disabled>
                                    <i class="fas fa-chevron-left"></i> Previous
                                </button>
                                <span id="page-info">Page 1 of 1</span>
                                <button id="next-page" class="pagination-btn" disabled>
                                    Next <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="content-container hidden" id="predict-content">
                <!-- Prediction Form Section -->
                <section class="card" id="prediction-form-section">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-line"></i> Predict Customer Churn</h2>
                    </div>
                    <div class="card-body">
                        <form id="predict-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="prediction-name">Prediction Name</label>
                                <input type="text" id="prediction-name" name="prediction_name" required
                                    placeholder="Enter a name for this prediction">
                            </div>

                            <div class="form-group">
                                <label for="model-select">Select Model</label>
                                <select id="model-select" name="model_id" required>
                                    <option value="" disabled selected>Select a model</option>
                                    <!-- Models will be populated by JavaScript -->
                                </select>
                                <div class="model-info" id="selected-model-info">
                                    <!-- Selected model info will be displayed here -->
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="dataset-upload">Upload Dataset</label>
                                <div class="file-upload-container">
                                    <div class="file-upload-message">Drag & drop your file here or click to browse</div>
                                    <input type="file" id="dataset-upload" name="dataset" required
                                        accept=".csv,.xlsx">
                                    <div class="file-upload-info">
                                        <p>Accepted formats: CSV, Excel</p>
                                        <p>Required columns: customerID, tenure, InternetService, etc.</p>
                                        <p>Max file size: 10MB</p>
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="action-button primary">
                                    <i class="fas fa-play"></i> Run Prediction
                                </button>
                                <button type="reset" class="action-button secondary">
                                    <i class="fas fa-undo"></i> Clear Form
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Prediction Results Section (Hidden initially) -->
                <section class="card hidden" id="prediction-results-section">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-pie"></i> Prediction Results</h2>
                        <button id="back-to-form" class="action-button secondary">
                            <i class="fas fa-arrow-left"></i> Back to Form
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="results-summary">
                            <div class="summary-item">
                                <h3>Prediction Name</h3>
                                <p id="result-prediction-name">-</p>
                            </div>
                            <div class="summary-item">
                                <h3>Model Used</h3>
                                <p id="result-model-name">-</p>
                            </div>
                            <div class="summary-item">
                                <h3>Total Records</h3>
                                <p id="result-total-records">-</p>
                            </div>
                            <div class="summary-item">
                                <h3>Prediction Date</h3>
                                <p id="result-date">-</p>
                            </div>
                        </div>

                        <div class="results-visualizations">
                            <div class="visualization-card">
                                <h3>Churn Distribution</h3>
                                <div class="chart-container">
                                    <canvas id="churn-distribution-chart"></canvas>
                                </div>
                            </div>
                            <div class="visualization-card">
                                <h3>Feature Importance</h3>
                                <div id="feature-importance-container" class="chart-container">
                                    <canvas id="feature-importance-chart"></canvas>
                                </div>
                                <div id="feature-importance-no-data" class="no-data-message" style="display: none;">
                                    Feature importance data not available for this model.
                                </div>
                            </div>
                        </div>

                        <!-- Prediction Results Preview -->
                        <div class="results-preview">
                            <h3>Results Preview</h3>
                            <div class="preview-container">
                                <div id="results-preview-table-container" class="table-responsive">
                                    <table id="results-preview-table" class="preview-table">
                                        <thead id="results-preview-thead">
                                            <!-- Headers will be populated by JavaScript -->
                                        </thead>
                                        <tbody id="results-preview-tbody">
                                            <!-- Data will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                                <div id="results-preview-no-data" class="no-data-message" style="display: none;">
                                    Preview data not available.
                                </div>
                            </div>
                        </div>

                        <div class="results-actions">
                            <button id="download-results" class="action-button primary">
                                <i class="fas fa-download"></i> Download Results
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Loading Overlay -->
                <div id="loading-overlay" class="hidden">
                    <div class="loading-spinner"></div>
                    <p>Processing your prediction...</p>
                </div>
            </div>

            <div class="content-container hidden" id="retrain-content">
                <section class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-sync-alt"></i> Retrain Model</h2>
                    </div>
                    <div class="card-body">
                        <div class="retrain-intro">
                            <p>Upload a new dataset to retrain the Gradient Boosting Machine model. The system will combine your dataset with existing data and create an improved model.</p>
                            <div class="info-box">
                                <i class="fas fa-info-circle"></i>
                                <div>
                                    <h4>Dataset Requirements</h4>
                                    <ul>
                                        <li>File format: CSV or Excel (.xlsx)</li>
                                        <li>Required columns: tenure, InternetService, OnlineSecurity, TechSupport, Contract, SeniorCitizen, Partner, Dependents, OnlineBackup, DeviceProtection, StreamingTV, StreamingMovies, PaymentMethod, PaperlessBilling, TotalCharges, MonthlyCharges, customerID, Churn</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <form id="retrain-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="dataset-name">Dataset Name</label>
                                <input type="text" id="dataset-name" name="dataset_name" placeholder="Enter a name for this dataset" required>
                            </div>

                            <div class="form-group">
                                <label>Upload Dataset</label>
                                <div class="file-upload-container">
                                    <input type="file" id="dataset-file" name="dataset_file" accept=".csv,.xlsx" required>
                                    <div class="file-upload-message">Drag & drop your file here or click to browse</div>
                                </div>
                                <div class="file-upload-info">
                                    <p>Accepted formats: CSV, Excel (.xlsx)</p>
                                    <p>Maximum file size: 10MB</p>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="action-button primary">
                                    <i class="fas fa-sync-alt"></i> Start Retraining
                                </button>
                            </div>
                        </form>

                        <div id="retrain-results" class="hidden">
                            <h3>Retraining Results</h3>

                            <div class="results-summary">
                                <div class="summary-item">
                                    <h4>Model Version</h4>
                                    <p id="model-version">-</p>
                                </div>
                                <div class="summary-item">
                                    <h4>Dataset</h4>
                                    <p id="dataset-info">-</p>
                                </div>
                                <div class="summary-item">
                                    <h4>Training Date</h4>
                                    <p id="training-date">-</p>
                                </div>
                            </div>

                            <div class="metrics-comparison">
                                <h4>Performance Metrics</h4>
                                <div class="metrics-table-container">
                                    <table class="metrics-table">
                                        <thead>
                                            <tr>
                                                <th>Metric</th>
                                                <th>Previous Model</th>
                                                <th>New Model</th>
                                                <th>Difference</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Accuracy</td>
                                                <td id="accuracy-previous">-</td>
                                                <td id="accuracy-new">-</td>
                                                <td id="accuracy-diff">-</td>
                                            </tr>
                                            <tr>
                                                <td>Precision</td>
                                                <td id="precision-previous">-</td>
                                                <td id="precision-new">-</td>
                                                <td id="precision-diff">-</td>
                                            </tr>
                                            <tr>
                                                <td>Recall</td>
                                                <td id="recall-previous">-</td>
                                                <td id="recall-new">-</td>
                                                <td id="recall-diff">-</td>
                                            </tr>
                                            <tr>
                                                <td>F1 Score</td>
                                                <td id="f1-previous">-</td>
                                                <td id="f1-new">-</td>
                                                <td id="f1-diff">-</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="retrain-actions">
                                <button id="deploy-model-btn" class="action-button primary">
                                    <i class="fas fa-rocket"></i> Deploy Model
                                </button>
                                <button id="new-retrain-btn" class="action-button secondary">
                                    <i class="fas fa-plus"></i> New Retraining
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Retraining Progress Modal -->
                <div id="retraining-progress-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2><i class="fas fa-sync-alt fa-spin"></i> Retraining in Progress</h2>
                        </div>
                        <div class="modal-body">
                            <div class="progress-container">
                                <div class="progress-step active" id="step-upload">
                                    <div class="step-icon"><i class="fas fa-upload"></i></div>
                                    <div class="step-content">
                                        <h4>Uploading Dataset</h4>
                                        <p>Uploading and validating your dataset...</p>
                                    </div>
                                </div>
                                <div class="progress-step" id="step-combine">
                                    <div class="step-icon"><i class="fas fa-object-group"></i></div>
                                    <div class="step-content">
                                        <h4>Combining Datasets</h4>
                                        <p>Merging with existing datasets...</p>
                                    </div>
                                </div>
                                <div class="progress-step" id="step-train">
                                    <div class="step-icon"><i class="fas fa-cogs"></i></div>
                                    <div class="step-content">
                                        <h4>Training Model</h4>
                                        <p>Training the GBM model with combined data...</p>
                                    </div>
                                </div>
                                <div class="progress-step" id="step-evaluate">
                                    <div class="step-icon"><i class="fas fa-chart-bar"></i></div>
                                    <div class="step-content">
                                        <h4>Evaluating Performance</h4>
                                        <p>Calculating metrics and comparing results...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="progress-message" id="progress-message">
                                Starting the retraining process...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-container hidden" id="history-content">
                <section class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-history"></i> Prediction History</h2>
                    </div>
                    <div class="card-body">
                        <div id="history-loading" class="loading-container">
                            <div class="loading-spinner"></div>
                            <p>Loading prediction history...</p>
                        </div>

                        <div id="history-empty" class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No Predictions Found</h3>
                            <p>You haven't made any predictions yet. Go to the Predict Churn section to get started.</p>
                            <button id="start-prediction-btn" class="action-button primary">
                                <i class="fas fa-chart-line"></i> Start Prediction
                            </button>
                        </div>

                        <div id="history-table-container" class="table-responsive" style="display: none;">
                            <table id="history-table" class="data-table">
                                <thead>
                                    <tr>
                                        <th>Prediction Name</th>
                                        <th>Model</th>
                                        <th>Date</th>
                                        <th>Records</th>
                                        <th>Churn Rate</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="history-table-body">
                                    <!-- Prediction history will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Prediction Details Modal -->
                <div id="prediction-details-modal" class="modal">
                    <div class="modal-content large-modal">
                        <div class="modal-header">
                            <h2><i class="fas fa-chart-pie"></i> <span id="modal-prediction-name">Prediction Details</span></h2>
                            <span class="close">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div class="modal-summary">
                                <div class="summary-item">
                                    <h3>Model Used</h3>
                                    <p id="modal-model-name">-</p>
                                </div>
                                <div class="summary-item">
                                    <h3>Date</h3>
                                    <p id="modal-date">-</p>
                                </div>
                                <div class="summary-item">
                                    <h3>Total Records</h3>
                                    <p id="modal-total-records">-</p>
                                </div>
                                <div class="summary-item">
                                    <h3>Churn Rate</h3>
                                    <p id="modal-churn-rate">-</p>
                                </div>
                            </div>

                            <div class="modal-visualizations">
                                <div class="visualization-card">
                                    <h3>Churn Distribution</h3>
                                    <div class="chart-container">
                                        <canvas id="modal-churn-chart"></canvas>
                                    </div>
                                </div>
                                <div class="visualization-card">
                                    <h3>Feature Importance</h3>
                                    <div id="modal-feature-container" class="chart-container">
                                        <canvas id="modal-feature-chart"></canvas>
                                    </div>
                                    <div id="modal-feature-no-data" class="no-data-message" style="display: none;">
                                        Feature importance data not available for this model.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="modal-download-original" class="action-button secondary">
                                <i class="fas fa-file-upload"></i> Download Original Dataset
                            </button>
                            <button id="modal-download-results" class="action-button primary">
                                <i class="fas fa-file-download"></i> Download Results
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FAQ Content -->
            <div class="content-container hidden" id="faq-content">
                <section class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-question-circle"></i> Frequently Asked Questions</h2>
                    </div>
                    <div class="card-body">
                        <div class="faq-container">
                            <div class="faq-search">
                                <input type="text" id="faq-search" placeholder="Search FAQs...">
                                <i class="fas fa-search"></i>
                            </div>

                            <div class="faq-categories">
                                <button class="faq-category-btn active" data-category="general">General</button>
                                <button class="faq-category-btn" data-category="data">Data</button>
                                <button class="faq-category-btn" data-category="models">Models</button>
                                <button class="faq-category-btn" data-category="prediction">Prediction</button>
                                <button class="faq-category-btn" data-category="retraining">Retraining</button>
                            </div>

                            <div class="faq-list">
                                <!-- No results message -->
                                <div id="faq-no-results" class="no-results" style="display: none;">
                                    <i class="fas fa-search"></i>
                                    <h3>No results found</h3>
                                    <p>Try different search terms or browse by category</p>
                                </div>

                                <!-- General System Information -->
                                <div class="faq-category" id="general">
                                    <h3>General System Information</h3>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>What is this system for?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>This system helps companies predict customer churn using machine learning. It enables both developers and users to upload customer data and receive predictions on which customers are likely to leave (churn) or stay. The developer dashboard provides additional capabilities for model management, retraining, and deployment, allowing technical teams to customize the prediction system for their company's specific needs.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>How does the churn prediction model work?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>The system uses machine learning models to analyze customer data and predict churn. Users upload a dataset, choose a model, and the system processes the data to return prediction results. Developers can use pre-trained default models or retrain models with company-specific data to improve prediction accuracy. The system analyzes patterns in customer behavior (such as tenure, contract type, and service usage) to identify factors that contribute to churn.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>What machine learning algorithms are used?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>The system offers five different machine learning models:</p>
                                            <ul>
                                                <li><strong>Gradient Boosting Machine (GBM)</strong> - Our highest accuracy default model, using 400 estimators with a learning rate of 0.01 and max depth of 5.</li>
                                                <li><strong>Random Forest</strong> - An ensemble model with 150 trees, max depth of 20, and class balancing for robust predictions.</li>
                                                <li><strong>Neural Network</strong> - A multi-layer perceptron with two hidden layers (100 and 50 neurons) using identity activation and SGD solver.</li>
                                                <li><strong>Logistic Regression</strong> - A linear model with L2 regularization (C=0.017) and class balancing.</li>
                                                <li><strong>Decision Tree</strong> - A simple interpretable model with max depth of 6 and minimum samples per leaf of 9.</li>
                                            </ul>
                                            <p>All default models are trained on a standard telecom customer dataset. For retraining, the system uses the GBM algorithm with the same parameters to ensure consistency while allowing for improved accuracy with company-specific data.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Data Requirements Category -->
                                <div class="faq-category" id="data" style="display: none;">
                                    <h3>Data Requirements</h3>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>What data format is required for prediction?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>The system accepts CSV and Excel (.xlsx, .xls) file formats for prediction. Your dataset must contain all the required columns for the model to work correctly. The system will validate your dataset upon upload and notify you of any missing or incorrectly formatted columns.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>What columns are required in the dataset?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>The required columns include:</p>
                                            <ul>
                                                <li><strong>Categorical features:</strong> InternetService, OnlineSecurity, TechSupport, Contract, SeniorCitizen, Partner, Dependents, OnlineBackup, DeviceProtection, StreamingTV, StreamingMovies, PaymentMethod, PaperlessBilling</li>
                                                <li><strong>Numerical features:</strong> tenure, TotalCharges, MonthlyCharges</li>
                                                <li><strong>Metadata:</strong> customerID (for identification purposes)</li>
                                            </ul>
                                            <p>The system will validate these columns when you upload a dataset and provide specific error messages if any required columns are missing.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>Can I upload datasets with extra columns?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>Yes, the system can handle datasets with extra columns. These additional columns will be preserved in the prediction results but won't be used for the prediction calculation. This allows you to maintain customer-specific information alongside the prediction results without affecting the model's performance.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Models Category -->
                                <div class="faq-category" id="models" style="display: none;">
                                    <h3>Models</h3>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>What's the difference between the available models?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>Each model has different strengths and characteristics:</p>
                                            <ul>
                                                <li><strong>Gradient Boosting Machine (GBM)</strong> - Typically has the highest accuracy and is good at handling complex relationships in data.</li>
                                                <li><strong>Random Forest</strong> - Very robust against overfitting and handles a mix of feature types well.</li>
                                                <li><strong>Neural Network</strong> - Can capture complex non-linear patterns but may require more data to perform well.</li>
                                                <li><strong>Logistic Regression</strong> - Simple, interpretable model that works well when relationships are mostly linear.</li>
                                                <li><strong>Decision Tree</strong> - Highly interpretable with clear decision rules, but may be less accurate than ensemble methods.</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>Which model has the highest accuracy?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>The Gradient Boosting Machine (GBM) model typically has the highest accuracy among our default models. This is why it's also used as the basis for model retraining. However, performance can vary depending on your specific data. You can compare model metrics in the "Available Models" section to choose the best model for your needs.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>What does model retraining do?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>Model retraining allows you to improve prediction accuracy by incorporating your company's specific customer data. When you retrain a model, the system:</p>
                                            <ol>
                                                <li>Combines your uploaded dataset with existing data</li>
                                                <li>Trains a new GBM model using this combined dataset</li>
                                                <li>Evaluates the new model's performance against the previous model</li>
                                                <li>Allows you to deploy the new model if it performs better</li>
                                            </ol>
                                            <p>This process helps the system learn patterns specific to your customer base, potentially improving prediction accuracy.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Prediction Category -->
                                <div class="faq-category" id="prediction" style="display: none;">
                                    <h3>Prediction</h3>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>How do I make a prediction?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>To make a prediction:</p>
                                            <ol>
                                                <li>Navigate to the prediction section in the dashboard</li>
                                                <li>Upload your dataset (CSV or Excel format)</li>
                                                <li>Enter a name for your prediction</li>
                                                <li>Select a model from the dropdown menu</li>
                                                <li>Click "Predict" to start the process</li>
                                                <li>View the results, including churn distribution and feature importance</li>
                                                <li>Download the prediction results or return to make another prediction</li>
                                            </ol>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>What do the prediction results mean?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>The prediction results show:</p>
                                            <ol>
                                                <li><strong>Churn Distribution</strong> - A pie chart showing the percentage of customers predicted to churn vs. stay</li>
                                                <li><strong>Feature Importance</strong> - A bar chart showing the top 5 factors influencing churn predictions</li>
                                                <li><strong>Preview</strong> - The first 10 rows of your dataset with added prediction columns</li>
                                            </ol>
                                            <p>You can download the complete results, which include your original data plus a "Churn_Prediction" column (Yes/No) and a "Churn_Probability" column (0-1 value).</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>How is feature importance calculated?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>Feature importance is calculated differently based on the model type:</p>
                                            <ul>
                                                <li>For tree-based models (GBM, Random Forest, Decision Tree), we use the built-in feature importance values</li>
                                                <li>For linear models (Logistic Regression), we use the absolute values of the coefficients</li>
                                                <li>For Neural Networks, we calculate importance based on the weights in the first layer</li>
                                            </ul>
                                            <p>All feature importance values are normalized to sum to 1.0, making them easier to interpret and compare across different models.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Retraining Category -->
                                <div class="faq-category" id="retraining" style="display: none;">
                                    <h3>Retraining</h3>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>When should I retrain a model?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>You should consider retraining a model when:</p>
                                            <ul>
                                                <li>You have new customer data that includes churn outcomes</li>
                                                <li>Your business has undergone significant changes that might affect churn patterns</li>
                                                <li>You've introduced new products or services that might influence customer behavior</li>
                                                <li>You want to improve prediction accuracy for your specific customer base</li>
                                            </ul>
                                            <p>Regular retraining (e.g., quarterly or bi-annually) can help keep your models up-to-date with evolving customer behavior patterns.</p>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>How does the retraining process work?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>The retraining process involves these steps:</p>
                                            <ol>
                                                <li><strong>Dataset Upload</strong>: You upload a dataset containing customer data with known churn outcomes</li>
                                                <li><strong>Dataset Validation</strong>: The system checks that your dataset has all required columns and proper formatting</li>
                                                <li><strong>Data Combination</strong>: For first-time retraining, your data is combined with the original dataset; for subsequent retraining, it's combined with the latest combined dataset</li>
                                                <li><strong>Model Training</strong>: A new GBM model is trained using the combined dataset</li>
                                                <li><strong>Performance Evaluation</strong>: The system compares metrics between the new model and the previous model</li>
                                                <li><strong>Deployment Option</strong>: You can choose to deploy the new model if it performs better</li>
                                            </ol>
                                        </div>
                                    </div>

                                    <div class="faq-item">
                                        <div class="faq-question">
                                            <h4>How do I deploy a retrained model?</h4>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="faq-answer">
                                            <p>After successfully retraining a model, you can deploy it by:</p>
                                            <ol>
                                                <li>Reviewing the performance metrics comparison between the new and previous models</li>
                                                <li>Clicking the "Deploy Model" button on the retraining results screen</li>
                                                <li>The model will be stored in the system and made available for predictions</li>
                                                <li>You can manage deployed models in the "Manage Models" section, where you can toggle their availability</li>
                                            </ol>
                                            <p>Once deployed, the new model will appear in the model selection dropdown when making predictions.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="error-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Error</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p id="error-message">An error occurred.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-button primary" id="error-ok-btn">OK</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/prediction.js') }}"></script>
    <script src="{{ url_for('static', filename='js/retrain.js') }}"></script>
    <script src="{{ url_for('static', filename='js/manage_models.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dev_dashboard.js') }}"></script>
</body>
</html>